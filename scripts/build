#/usr/bin/sh

# Basic build script
# https://wails.io/docs/guides/manual-builds

proj_home=$(pwd)
install_frontend=$($proj_home/scripts/parse "frontend:install")
build_frontend=$($proj_home/scripts/parse "frontend:build")
qua_name=$($proj_home/scripts/parse "outputfilename")

build_frontend() {
    printf "Installing -> \`$install_frontend\`...\n"
    cd $proj_home/frontend ; $install_frontend ; printf "Done \`pnpm i\` ($?)\n"

    printf "Building -> \`$build_frontend\`...\n"
    $build_frontend > /dev/null ; printf "Done \`pnpm run build\` ($?)\n"
}

build_app() {
    printf "Building -> \`$qua_name\`...\n"
    cd $proj_home ; go build -tags desktop,production -ldflags "-w -s" -o $proj_home/build/bin/$qua_name $proj_home/main.go > /dev/null

    printf "Done \`$qua_name\` ($?)\n"
}

build_frontend
build_app
